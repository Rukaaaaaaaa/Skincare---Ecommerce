<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <title>Beautya - Skincare & Makeup</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.9" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <img src="{% static 'img/unsplash_HvkDYluePqw.png' %}" alt="LOGO">
      <span class="shop-name">BEAUTYA</span>
    </div>

        <nav class="nav-menu">
            <a href="{% url 'home' %}" class="nav-link">Home</a>
            <a href="{% url 'product_list' %}" class="nav-link">Products</a>
            <a href="{% url 'about' %}" class="nav-link">About Us</a>
            <a href="{% url 'contact' %}" class="nav-link">Contacts</a>
            <a href="{% url 'login' %}" class="nav-link">Sign in</a>
    </nav>

    <div class="header-actions">
      <div class="cart-wrapper">
        <i class="fas fa-shopping-cart cart-icon" onclick="window.location.href='cart.html'"></i>
        <span class="cart-count">0</span>
      </div>
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
    </div>
  </header>

  <!-- Hero Slider -->
  <section class="hero-slider">
    <div class="slideshow-wrapper">
      {% for slide in slides %}
      <div class="slide">
        {% if slide.image|slice:":4" == "http" %}
        <img src="{{ slide.image }}" alt="{{ slide.alt }}">
        {% else %}
        <img src="{% static slide.image %}" alt="{{ slide.alt }}">
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <div class="hero-content">
      <h1 class="hero-title">Unlock your natural glow</h1>
      <a href="#" class="button button-outline">Xem Thêm</a>
    </div>

    <!-- Navigation arrows -->
    <div class="slider-arrow" style="left: 20px; top: 50%" onclick="moveSlide(-1)">
      <i class="fas fa-chevron-left"></i>
    </div>
    <div class="slider-arrow" style="right: 20px; top: 50%" onclick="moveSlide(1)">
      <i class="fas fa-chevron-right"></i>
    </div>
  </section>

  <!-- Dots navigation -->
  <div class="slider-dots-outside">
    {% for slide in slides %}
    <span class="dot {% if forloop.first %}active{% endif %}" onclick="currentSlide('{{ forloop.counter0 }}')"></span>
    {% endfor %}
  </div>


  <!-- Categories -->
  <section>
    <h2 class="section-header">Danh Mục Sản Phẩm</h2>
    <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
      {% for category in categories %}
      <div class="category-card">
        <img src="{{ category.image.url }}" alt="{{ category.name }}">
        <div class="category-name">{{ category.name }}</div>
      </div>
      {% endfor %}
    </div>
  </section>
  <!-- Virtual Skincare Analysis -->
  {% if analysis %}
  <section class="virtual-analysis-section">
    <div class="analysis-content">
      <h3>{{ analysis.title }}</h3>
      <br>
      <p>{{ analysis.description|linebreaksbr }}</p>
      <br>
      <div class="scan-options">
        <div class="scan-text">Scan with your phone to get started or</div>
      </div>
      <a href="#" class="button button-outline">Answer a few questions</a>
      <img src="{{ analysis.qr_code.url }}" alt="QR Code" class="qr-code">
    </div>

    <div class="analysis-image-wrapper">
      <img src="{{ analysis.image.url }}" alt="Virtual Skincare" class="main-image">
    </div>
  </section>
  {% endif %}

  <!-- Best Sellers -->
  <section class="product-section">
    <h2 class="section-header">Best Sellers</h2>

    <div class="product-slider-container">
      <!-- Left Arrow -->
      <button class="product-slider-nav left" onclick="scrollProducts(-1)">
        <span class="nav-arrow-icon"></span>
      </button>

      <!-- Product Slider -->
      <div class="product-slider" id="productSlider">
        <div class="product-grid">
          {% for product in best_sellers %}
          <div class="product-card">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <div class="product-info">
              <h3 class="product-title">{{ product.name }}</h3>
              <p>{{ product.description|truncatewords:15 }}</p>
              <div class="product-price">₫{{ product.price }}</div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Right Arrow -->
      <button class="product-slider-nav right" onclick="scrollProducts(1)">
        <span class="nav-arrow-icon"></span>
      </button>
    </div>
  </section>

  <section class="product-section dark-bg">
    <h2 class="section-header" style="color: white">New In</h2>

    <div class="product-slider-container">
      <button class="product-slider-nav left" onclick="scrollNewProducts(-1)">
        <span class="nav-arrow-icon"></span>
      </button>

      <div class="product-slider" id="newProductSlider">
        <div class="product-grid">
          {% for product in new_products %}
          <div class="product-card">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <div class="product-info">
              <h3 class="product-title">{{ product.name }}</h3>
              <p>{{ product.description|truncatewords:15 }}</p>
              <div class="product-price">₫{{ product.price }}</div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <button class="product-slider-nav right" onclick="scrollNewProducts(1)">
        <span class="nav-arrow-icon"></span>
      </button>
    </div>
  </section>


  <!-- Special Offers -->
  {% if offer %}
  <section class="special-offers-section">
    <div class="special-offers-container">
      <!-- Right: Image -->
      <div class="special-offers-image">
        <img src="{{ offer.image.url }}" alt="Special Offer" />
      </div>

      <!-- Left: Text -->
      <div class="special-offers-content">
        <h3 class="special-offers-subtitle">{{ offer.subtitle }}</h3>
        <h2 class="special-offers-title">{{ offer.title }}</h2>

        <p class="special-offers-text">
          {{ offer.content|linebreaksbr }}
        </p>

        <p class="special-offers-highlight">
          {{ offer.highlight }}
        </p>
        <br />
      </div>
    </div>
  </section>
  {% endif %}


  <section class="blog-section">
    <div class="blog-header">
      <h2 class="section-header">Our Blog</h2>
      <a href="{% url 'blog_list' %}" class="button">Xem Thêm</a>
    </div>
    <div class="blog-grid">
      {% for post in latest_posts %}
      <div class="blog-card">
        <img src="{{ post.image.url }}" alt="{{ post.title }}" />
        <div class="blog-content">
          <div class="blog-meta">
            <span>{{ post.category }}</span>
            <span>•</span>
            <span>{{ post.author }}</span>
            <span>•</span>
            <span>{{ post.created_at|date:"M d, Y" }}</span>
          </div>
          <h3 class="blog-title">{{ post.title }}</h3>
          <p class="blog-excerpt">{{ post.excerpt }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>


  <!-- Footer -->
  <footer>
    <!-- Footer Top -->
    <div class="footer-top">
      <div class="benefit-item">
        <i class="fas fa-paw benefit-icon"></i>
        <span class="benefit-text">Không thử nghiệm trên động vật</span>
      </div>
      <div class="benefit-item">
        <i class="fas fa-leaf benefit-icon"></i>
        <span class="benefit-text">Không có thành phần từ động vật</span>
      </div>
      <div class="benefit-item">
        <i class="fas fa-bread-slice benefit-icon"></i>
        <span class="benefit-text">Không có gluten, hoặc sản phẩm phụ từ gluten</span>
      </div>
      <div class="benefit-item">
        <i class="fas fa-recycle benefit-icon"></i>
        <span class="benefit-text">Bao bì có thể tái chế</span>
      </div>
    </div>

    <!-- Footer Main -->
    <div class="footer-main">
      <div class="footer-column">
        <h3>Chúng tôi có thể giúp gì?</h3>
        <ul>
          <li><a href="#">Beautya branches</a></li>
          <li><a href="#">Contact Us</a></li>
          <li><a href="FAQ.html">FAQ</a></li>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Blog</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Products</h3>
        <ul>
          <li><a href="#">Chính Sách Bảo Mật</a></li>
          <li><a href="#">Chính Sách Bảo Hành</a></li>
          <li><a href="#">Trả Hàng/Hoàn Tiền</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Giữ liên lạc với Beautya</h3>
        <p style="color: white; margin-bottom: 24px">
          Hãy tham gia nhận bản tin của Beautya để là người đầu tiên biết về tin tức, ưu đãi và lời khuyên chăm sóc da.
        </p>
        <form class="newsletter-form">
          <input type="email" placeholder="Email" class="newsletter-input" />
          <button type="submit" class="newsletter-submit">Subscribe</button>
        </form>
        <label class="consent-text">
          <input type="checkbox" required>
          Bằng cách gửi email của bạn, bạn đồng ý nhận các email quảng cáo từ Beautya.
        </label>
      </div>
    </div>
    </div>

    <div class="footer-contact-row">
      <div class="footer-contact-group">
        <span><i class="fas fa-map-marker-alt"></i>Hà Nội, Việt Nam</span>
        <span><i class="fas fa-phone-alt"></i>0-123-456-789</span>
      </div>
      <div class="footer-social-group">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-pinterest"></i></a>
        <a href="#"><i class="fab fa-youtube"></i></a>
        <a href="#"><i class="fab fa-tiktok"></i></a>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="copyright">© 2025 Beautya. All Rights Reserved.</div>
      <div class="legal-links">
        <a href="#">Terms & Conditions</a>
        <a href="#">Privacy Policy</a>
      </div>
    </div>
  </footer>

  <script src="include.js"></script>
  <script>
    // Hero Slider functionality
    let slideIndex = 0;
    const slides = document.querySelectorAll(".slide");
    const dots = document.querySelectorAll(".dot");
    const wrapper = document.querySelector(".slideshow-wrapper");

    function showSlide(n) {
      if (n >= slides.length) slideIndex = 0;
      if (n < 0) slideIndex = slides.length - 1;

      wrapper.style.transform = `translateX(-${slideIndex * 100}%)`;

      dots.forEach((dot, i) => {
        dot.classList.toggle("active", i === slideIndex);
      });
    }

    function moveSlide(n) {
      showSlide((slideIndex += n));
    }

    function currentSlide(n) {
      showSlide((slideIndex = n));
    }

    // Auto slide
    let slideInterval = setInterval(() => moveSlide(1), 3000);

    // Pause on hover
    const slideshow = document.querySelector(".hero-slider");
    slideshow.addEventListener("mouseenter", () =>
      clearInterval(slideInterval)
    );
    slideshow.addEventListener("mouseleave", () => {
      slideInterval = setInterval(() => moveSlide(1), 3000);
    });

    // Initialize
    showSlide(slideIndex);

    // Slider functionality for both Best Sellers and New In
    function setupSlider(sliderId) {
      const slider = document.getElementById(sliderId);
      const productGrid = slider.querySelector('.product-grid');
      const cards = productGrid.querySelectorAll('.product-card');
      const cardWidth = cards[0].offsetWidth + 24; // card width + gap
      const visibleCards = 4;
      let currentIndex = 0;
      const totalCards = cards.length;

      function scrollSlider(direction) {
        currentIndex += direction;

        // Handle wrapping around
        if (currentIndex >= totalCards - visibleCards + 1) {
          currentIndex = 0;
        } else if (currentIndex < 0) {
          currentIndex = totalCards - visibleCards;
        }

        productGrid.style.transition = 'transform 0.5s ease';
        productGrid.style.transform = `translateX(-${currentIndex * cardWidth}px)`;
      }

      return scrollSlider;
    }

    const scrollProducts = setupSlider('productSlider');
    const scrollNewProducts = setupSlider('newProductSlider');

    // Make sliders responsive
    window.addEventListener('resize', function () {
      // Reset sliders on resize
      document.querySelectorAll('.product-grid').forEach(grid => {
        grid.style.transition = 'none';
        grid.style.transform = 'translateX(0)';
        // Force reflow
        void grid.offsetWidth;
        grid.style.transition = 'transform 0.5s ease';
      });
    });

    // Newsletter form submission
    newsletterForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const emailInput = this.querySelector('input[type="email"]');
      fetch("{% url 'subscribe_newsletter' %}", {
        method: "POST",
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `email=${encodeURIComponent(emailInput.value)}`
      })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(err => alert("Error subscribing."));
    });



    // include.js
    function includeHTML() {
      const elements = document.querySelectorAll('[data-include]');
      elements.forEach(el => {
        const file = el.getAttribute('data-include');
        fetch(file)
          .then(response => {
            if (response.ok) return response.text();
            throw new Error('Page not found');
          })
          .then(data => el.innerHTML = data)
          .catch(err => console.error('Error including HTML:', err));
      });
    }
    document.addEventListener('DOMContentLoaded', includeHTML);

  </script>
</body>

</html>