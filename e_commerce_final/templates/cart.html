<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <title>Beautya - Skincare & Makeup</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    .cart-page {
      max-width: 1200px;
      padding: 0 20px;
      margin: auto;
    }

    .cart-page h1 {
      font-size: 28px;
      color: #c80064;
      margin: 20px 0 30px;
      font-weight: 700;
    }

    .cart-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 40px;
    }

    .cart-table thead {
      background-color: #f9f9f9;
      font-weight: bold;
    }

    .cart-table th,
    .cart-table td {
      text-align: left;
      padding: 15px;
      border-bottom: 1px solid #eee;
    }

    .cart-table td img {
      width: 80px;
      height: 80px;
      vertical-align: middle;
      margin: 0 20px;
      border-radius: 5px;
    }

    .cart-actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
    }

    .cart-actions button {
      padding: 10px 20px;
      background-color: white;
      color: #333;
      border: 1px solid #ccc;
      cursor: pointer;
      transition: 0.3s;
    }

    .cart-actions button:hover {
      background-color: #f2f2f2;
    }

    .cart-summary {
      width: 400px;
      border: 1px solid #ccc;
      padding: 20px;
      margin: auto;
      margin-bottom: 20px;
    }

    .cart-summary h3 {
      margin-bottom: 15px;
    }

    .qty-input {
      width: 60px;
      padding: 5px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .cart-summary p {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }

    .cart-summary .price {
      text-align: right;
      font-weight: 600;
    }

    .cart-summary button {
      margin-top: 15px;
      width: 100%;
      padding: 12px;
      background-color: #c80064;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    .empty-cart {
      text-align: center;
      padding: 40px 0;
      font-size: 18px;
      color: #777;
    }

    .empty-cart a.btn {
      margin-top: 10px;
    }

    .cart-summary button:hover {
      background-color: #a0004f;
    }
  </style>
</head>
{% load static %}
{% load humanize %}

<body>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <img src="{% static 'img/unsplash_HvkDYluePqw.png' %}" alt="LOGO">
      <span class="shop-name">BEAUTYA</span>
    </div>

    <nav class="nav-menu">
      <a href="{% url 'home' %}" class="nav-link">Home</a>
      <a href="{% url 'product_list' %}" class="nav-link">Products</a>
      <a href="{% url 'about' %}" class="nav-link">About Us</a>
      <a href="{% url 'contact' %}" class="nav-link">Contacts</a>

      {% if not request.user.is_authenticated %}
      <a href="{% url 'login' %}" class="nav-link">Sign in</a>
      {% else %}
      <a href="{% url 'logout' %}" class="nav-link">Logout</a>
      {% endif %}
    </nav>

    <div class="header-actions">
      <div class="cart-wrapper">
        <i class="fas fa-shopping-cart cart-icon" onclick="goToCart()"></i>
        <span class="cart-count">0</span>
      </div>
      <i class="fa-solid fa-magnifying-glass search-icon" onclick="toggleSearchBar()"></i>

      {% if request.user.is_authenticated %}
      <a href="{% url 'profile' %}" class="user-name">
        <i class="fas fa-user"></i> {{ request.user.get_full_name|default:request.user.username }}
      </a>
      {% endif %}
    </div>
  </header>


  <!-- Search Bar d√≠nh c·ªë ƒë·ªãnh ngay d∆∞·ªõi header -->
  <div id="search-bar-wrapper" class="search-bar-wrapper">
    <form method="get" action="{% url 'search' %}">
      <input type="text" name="q" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." required>
      <button type="submit">T√¨m</button>
    </form>
  </div>

  <script>
    function goToCart() {
      window.location.href = "{% url 'cart' %}";
    }

    function toggleSearchBar() {
      const wrapper = document.getElementById('search-bar-wrapper');
      wrapper.style.display = wrapper.style.display === 'block' ? 'none' : 'block';
    }
  </script>


  <!-- Cart Content -->
  <main class="cart-page">
    <h1>Cart</h1>
    <form method="post" action="{% url 'checkout' %}">
      {% csrf_token %}
      <table class="cart-table">
        <thead>
          <tr>
            <th>S·∫£n ph·∫©m</th>
            <th>Gi√°</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>T·ªïng ti·ªÅn</th>
            <th>Xo√°</th>
          </tr>
        </thead>
        <tbody>
          {% if cart_items %}
          {% for item in cart_items %}
          <tr>
            <td><img src="{{ item.product.image.url }}" alt="{{ item.product.name }}"> {{ item.product.name }}</td>
            <td>{{ item.product.price|intcomma }}<small>ƒë</small></td>
            <td><input type="number" name="quantity" min="1" value="{{ item.quantity }}"
                onchange="updateQty(this, '{{ item.id }}')"></td>
            <td>{{ item.subtotal|intcomma }}<small>ƒë</small></td>
            <td>
              <a href="{% url 'remove_cart_item' item.id %}" class="remove-btn"
                style="color: #a0004f; font-size: medium;">X</a>
            </td>

          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="5" class="empty-cart">
              <p style="color: #c80064;margin-bottom: 100px;">üõí Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</p>
              <a href="{% url 'home' %}" class="btn btn-primary" style=" margin-top: 100px;
                    width: 100%;
                    padding: 12px;
                    background-color: #c80064;
                    color: white;
                    border: none;
                    border-radius: 3px;
                    cursor: pointer;
                    font-weight: 600;
                    transition: 0.3s;">Ti·∫øp t·ª•c mua s·∫Øm</a>
            </td>
          </tr>
          {% endif %}
        </tbody>

      </table>

      <div class="cart-summary">
        <p><strong>T·ªïng:</strong> {{ total|intcomma }}<small>ƒë</small></p>
        {% if cart_items %}
        <button href="{% url 'checkout' %}" class="checkout-btn">Thanh To√°n</button>
        {% else %}
        <button class="checkout-btn" disabled style="opacity: 0.6; cursor: not-allowed;">Gi·ªè h√†ng tr·ªëng</button>
        {% endif %}
      </div>

    </form>
  </main>

  <script>
    function updateSubtotal(row) {
      const price = parseInt(row.querySelector('.item-price').dataset.price);
      const qty = parseInt(row.querySelector('.qty-input').value);
      const subtotal = price * qty;
      row.querySelector('.item-subtotal').textContent = subtotal.toLocaleString() + 'ƒë';
      updateTotal();
    }

    function updateQty(input) {
      if (parseInt(input.value) < 1) input.value = 1;
      updateSubtotal(input.closest('tr'));
    }

    function updateTotal() {
      let total = 0;
      document.querySelectorAll('tbody tr').forEach(row => {
        const checkbox = row.querySelector('.select-item');
        if (checkbox.checked) {
          const subtotalText = row.querySelector('.item-subtotal').textContent.replace(/[^\d]/g, '');
          total += parseInt(subtotalText);
        }
      });
      document.querySelector('.cart-summary .price').innerHTML = '<strong>' + total.toLocaleString() + '<small>ƒë</small></strong>';
    }

    document.getElementById('select-all').addEventListener('change', function () {
      document.querySelectorAll('.select-item').forEach(cb => cb.checked = this.checked);
      updateTotal();
    });

    document.querySelectorAll('.select-item').forEach(cb => {
      cb.addEventListener('change', updateTotal);
    });

    function updateCart() {
      document.querySelectorAll('.select-item:checked').forEach(cb => {
        cb.closest('tr').remove();
      });
      updateTotal();
    }

    window.onload = () => {
      document.querySelectorAll('tbody tr').forEach(row => updateSubtotal(row));
    };
  </script>

  <!-- Footer -->
  <footer>
    <!-- Footer Top -->
    <div class="footer-top">
      <div class="benefit-item">
        <i class="fas fa-paw benefit-icon"></i>
        <span class="benefit-text">Kh√¥ng th·ª≠ nghi·ªám tr√™n ƒë·ªông v·∫≠t</span>
      </div>
      <div class="benefit-item">
        <i class="fas fa-leaf benefit-icon"></i>
        <span class="benefit-text">Kh√¥ng c√≥ th√†nh ph·∫ßn t·ª´ ƒë·ªông v·∫≠t</span>
      </div>
      <div class="benefit-item">
        <i class="fas fa-bread-slice benefit-icon"></i>
        <span class="benefit-text">Kh√¥ng c√≥ gluten, ho·∫∑c s·∫£n ph·∫©m ph·ª• t·ª´ gluten</span>
      </div>
      <div class="benefit-item">
        <i class="fas fa-recycle benefit-icon"></i>
        <span class="benefit-text">Bao b√¨ c√≥ th·ªÉ t√°i ch·∫ø</span>
      </div>
    </div>

    <!-- Footer Main -->
    <div class="footer-main">
      <div class="footer-column">
        <h3>Ch√∫ng t√¥i c√≥ th·ªÉ gi√∫p g√¨?</h3>
        <ul>
          <li><a href="#">Beautya branches</a></li>
          <li><a href="#">Contact Us</a></li>
          <li><a href="#">FAQ</a></li>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Blog</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Products</h3>
        <ul>
          <li><a href="#">Ch√≠nh S√°ch B·∫£o M·∫≠t</a></li>
          <li><a href="#">Ch√≠nh S√°ch B·∫£o H√†nh</a></li>
          <li><a href="#">Tr·∫£ H√†ng/Ho√†n Ti·ªÅn</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Gi·ªØ li√™n l·∫°c v·ªõi Beautya</h3>
        <p style="color: white; margin-bottom: 24px">
          H√£y tham gia nh·∫≠n b·∫£n tin c·ªßa Beautya ƒë·ªÉ l√† ng∆∞·ªùi ƒë·∫ßu ti√™n bi·∫øt v·ªÅ tin t·ª©c, ∆∞u ƒë√£i v√† l·ªùi khuy√™n chƒÉm s√≥c da.
        </p>
        <form class="newsletter-form">
          <input type="email" placeholder="Email" class="newsletter-input" />
          <button type="submit" class="newsletter-submit">Subscribe</button>
        </form>
        <label class="consent-text">
          <input type="checkbox" required>
          B·∫±ng c√°ch g·ª≠i email c·ªßa b·∫°n, b·∫°n ƒë·ªìng √Ω nh·∫≠n c√°c email qu·∫£ng c√°o t·ª´ Beautya.
        </label>
      </div>
    </div>
    </div>

    <div class="footer-contact-row">
      <div class="footer-contact-group">
        <span><i class="fas fa-map-marker-alt"></i>H√† N·ªôi, Vi·ªát Nam</span>
        <span><i class="fas fa-phone-alt"></i>0-123-456-789</span>
      </div>
      <div class="footer-social-group">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-pinterest"></i></a>
        <a href="#"><i class="fab fa-youtube"></i></a>
        <a href="#"><i class="fab fa-tiktok"></i></a>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="copyright">¬© 2025 Beautya. All Rights Reserved.</div>
      <div class="legal-links">
        <a href="#">Terms & Conditions</a>
        <a href="#">Privacy Policy</a>
      </div>
    </div>
  </footer>
</body>

</html>